webpackJsonp([0],[function(e,t,o){(function(e,t,o,a){function r(t){e.info("Filtering sites...",{timeOut:0}),h.clearLayers();var o=L.geoJson(y,{filter:function(e,o){return"CountySelect"===t.selectName?e.properties.countyCode===t.optionValue:"HUCSelect"===t.selectName?e.properties.hucCode===t.optionValue:"AquiferSelect"===t.selectName?e.properties.aquiferCode===t.optionValue:"WellDepthSelect"===t.selectName?e.properties.wellDepth===t.optionValue:void 0},pointToLayer:function(e,t){return L.circleMarker(t,N)},onEachFeature:function(e,t){t.bindPopup("<b>"+e.properties.siteID+"</b></br></br>"+e.properties.siteName+'</br><a href="http://waterdata.usgs.gov/nwis/inventory/?site_no='+e.properties.siteID+'" target="_blank">Access Data</a></br></br>')}});h.addLayer(o),m.fitBounds(h.getBounds()),e.clear()}function i(){h.clearLayers(),y={type:"FeatureCollection",features:[]},e.info("Querying NWIS...",{timeOut:0}),t.ajax({url:"./qwdataAll.xml",dataType:"xml",success:function(o){e.clear(),e.info("Parsing sites...",{timeOut:0}),t(o).find("site").each(function(){var e=t(this).find("site_no").text(),o=t(this).find("station_nm").text(),a=t(this).find("dec_lat_va").text(),r=t(this).find("dec_long_va").text(),i=t(this).find("agency_cd").text(),n=t(this).find("county_cd").text(),s=t(this).find("huc_cd").text(),c=t(this).find("aqfr_cd").text(),l=t(this).find("well_depth_va").text(),u={type:"Feature",properties:{siteID:e,siteName:o,latDD:a,lonDD:r,agencyCode:i,countyCode:n,hucCode:s,aquiferCode:c,wellDepth:l},geometry:{type:"Point",coordinates:[parseFloat(r),parseFloat(a)]}};y.features.push(u)}),e.clear(),e.info("Drawing GeoJSON...",{timeOut:0});var a=L.geoJSON(y,{pointToLayer:function(e,t){return L.circleMarker(t,N)},onEachFeature:function(e,t){t.bindPopup("<b>"+e.properties.siteID+"</b></br></br>"+e.properties.siteName+'</br><a href="http://waterdata.usgs.gov/nwis/inventory/?site_no='+e.properties.siteID+'" target="_blank">Access Data</a></br></br>')}});h.addLayer(a),console.log(y.features.length,"sites loaded"),e.clear(),t("#sitesPanel").collapse("toggle"),t("#filtersPanel").collapse("toggle")}})}function n(){t.each(C,function(e,o){"County"===o&&(t("#filters").append('<select class="form-control NWISselect" id="'+o+'Select"><option selected="selected" value="default">Select a '+o+"</option></select>"),"County"===o&&t.getJSON("./countyCodesNY.json",function(e){t.each(e,function(e,a){var r="#"+o+"Select";t(r).append(t("<option></option>").attr("value",a.CountyCd).attr("stateCounty",a.StateCd+a.CountyCd).text(a.CountyName.replace(" County","")))})}))})}function s(o){e.info("Getting QW Data...",{timeOut:0});var a=h.toGeoJSON(),r={type:"FeatureCollection",features:[]};if(h.clearLayers(),a.features.length>0){console.log("querying NWIS...");var i=t("#CountySelect :selected").attr("stateCounty"),o=t("#parameterCodes").val(),n=o.split(",");t.ajax({url:"https://nwis.waterdata.usgs.gov/ny/nwis/qwdata",data:{county_cd:i?i:"",site_tp_cd:"GW",group_key:"NONE",sitefile_output_format:"html_table",column_name:"agency_cd",column_name:"site_no",column_name:"station_nm",inventory_output:0,rdb_inventory_output:"file",TZoutput:0,pm_cd_compare:"Greater%20than",radio_parm_cds:"parm_cd_list",radio_multiple_parm_cds:o?o:"00940",qw_attributes:0,format:"rdb",qw_sample_wide:"wide",rdb_qw_attributes:0,date_format:"YYYY-MM-DD",rdb_compression:"YYYY-MM-DD",sitefile_output_format:"value",list_of_search_criteria:"site_tp_cd"},dataType:"text",success:function(o){var i=p(o);console.log("got a response:",i.length,"sites"),t.each(a.features[0].features,function(e,o){var a=o,s=!1;t.each(i,function(e,r){o.properties.siteID===r.site_no&&(t.each(n,function(e,t){r.hasOwnProperty("p"+t)&&(a.properties["p"+t+"|"+r.sample_dt+" "+r.sample_tm+" "+r.sample_start_time_datum_cd+"|"+r.medium_cd]=r["p"+t])}),s=!0)}),s&&r.features.push(a)});var s=L.geoJson(r,{pointToLayer:function(e,t){return L.circleMarker(t,N)},onEachFeature:function(e,o){var a=t("<div>",{id:"popup"});t.each(e.properties,function(e,t){a.append("<b>"+e+":</b>  "+t+"</br>")}),o.bindPopup(a.html())}});h.addLayer(s),m.fitBounds(h.getBounds()),console.log(r.features.length,"sites loaded"),e.clear(),t("#filtersPanel").collapse("toggle"),t("#exportPanel").collapse("toggle")}})}else e.error("Error","No sites to display")}function c(){if(h.toGeoJSON().features[0]){var t=JSON.stringify(h.toGeoJSON().features[0]),o="data.geojson";u(t,o)}else e.error("Error","No sites to export")}function l(){if(h.toGeoJSON().features[0]){var t=h.toGeoJSON().features[0],a=o(t),r="data.kml";u(a,r)}else e.error("Error","No sites to export")}function u(e,t){var o=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,t);else{var a=document.createElement("a"),r=URL.createObjectURL(o);void 0!==a.download?(a.setAttribute("href",r),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(r)}}function p(e){var o,a=e.split(/\r?\n/),r=[];return t.each(a,function(e,t){var a={};if("#"!=t[0]){var i=t.split("\t");if("agency_cd"===i[0]&&(o=i),"5s"!==i[0]&&"agency_cd"!==i[0]){for(var n=0;n<o.length;n++)a[o[n]]=i[n];r.push(a)}}}),r}function d(e){switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="Terrain";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}_&&m.removeLayer(_),_=a.basemapLayer(e),m.addLayer(_),g&&m.removeLayer(g),"Gray"!==e&&"Imagery"!==e&&"Terrain"!==e||(g=a.basemapLayer(e+"Labels"),m.addLayer(g))}function f(){h.clearLayers(),m.setView([v,b],7)}var m,y,h,_,g,b="-76.2",v="42.7",C=["County","HUC","Aquifer","WellDepth"],N={radius:4,fillColor:"#ff7800",color:"#000",weight:1,opacity:1,fillOpacity:.8};e.options={positionClass:"toast-bottom-right"},t(document).ready(function(){console.log("Application Information: production version 0.0.1"),t("#appVersion").html("Application Information: production version 0.0.1"),m=L.map("mapDiv",{zoomControl:!1}),L.control.zoom({position:"topright"}).addTo(m),L.control.scale().addTo(m),layer=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ",maxZoom:16}).addTo(m),m.setView([v,b],7),h=L.featureGroup().addTo(m),n(),t("#mobile-main-menu").click(function(){t("body").toggleClass("isOpenMenu")}),t(".basemapBtn").click(function(){t(".basemapBtn").removeClass("slick-btn-selection"),t(this).addClass("slick-btn-selection");var e=this.id.replace("btn","");d(e)}),t("#loadSites").click(function(){i()}),t("#resetView").click(function(){f()}),t("#aboutButton").click(function(){t("#aboutModal").modal("show")}),t("#getQWdata").click(function(){s()}),t("#exportGeoJSON").click(function(){c()}),t("#exportKML").click(function(){l()}),t(".NWISselect").on("change",function(){var e=t("option:selected",this).parent().attr("id"),o=t("option:selected",this).text(),a=t("option:selected",this).attr("value"),i={selectName:e,optionName:o,optionValue:a};r(i)})})}).call(t,o(1),o(2),o(4),o(6))}]);