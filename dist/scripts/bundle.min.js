webpackJsonp([0],[function(e,t,o){(function(e,t,o,a,r){function i(e){b.clearLayers();var o=L.geoJson(e,{pointToLayer:function(e,t){return L.circleMarker(t,F)},onEachFeature:function(e,o){var a=t("<div>",{id:"popup"});t.each(e.properties,function(e,t){a.append("<b>"+e+":</b>  "+t+"</br>")}),o.bindPopup(a.html())}});b.addLayer(o),v.fitBounds(b.getBounds())}function n(){t(".selectpicker").selectpicker("deselectAll"),C=[],h(),i(D)}function s(){t.each(G,function(e,a){console.log("processing: ",a.groupHeading),t.each(a.layers,function(e,t){"agisDynamic"===t.wimOptions.layerType&&(mapServer=o.dynamicMapLayer(t),l(k))})})}function l(o){t.each(o,function(o,a){e.info(a.layerName,"Getting geoFilters:"),mapServer.query().layer(a.layerID).returnGeometry(!1).where("1=1").run(function(o,r){if(r&&r.features.length>0){t("#geoFilterSelect").append("<select id='"+a.dropDownID+"' class='selectpicker geoFilterSelect' multiple data-selected-text-format='count' data-dropup-auto='false' title='"+a.layerName+"'></select>");for(var i=r.features,n=0;n<i.length;n++)t("#"+a.dropDownID).append(t("<option></option>").attr("layerID",a.layerID).val(i[n].properties[a.outFields[1]]).html(i[n].properties[a.outFields[0]]));t("#"+a.dropDownID).html(t("#"+a.dropDownID+" option").sort(function(e,t){return e.text==t.text?0:e.text<t.text?-1:1})),t(".selectpicker").selectpicker("refresh")}else e.error(o.message,"Error getting geoFilter list for "+a.layerName)})})}function c(t,o){e.info("Filtering sites...",{timeOut:0});var r=a(t,o);return console.log("clip result features:",r.features.length),r.features.length>0?(e.clear(),r):(e.clear(),e.error("Error","No sites to display"),null)}function p(t){e.info("Filtering sites...",{timeOut:0}),i(siteGeoJSON),e.clear()}function u(){I=!1,b.clearLayers(),D={type:"FeatureCollection",features:[]},e.info("Querying NWIS...",{timeOut:0}),t.ajax({url:"./qwdataAll.xml",dataType:"xml",success:function(o){e.clear(),e.info("Parsing sites...",{timeOut:0}),t(o).find("site").each(function(){var e=t(this).find("site_no").text(),o=t(this).find("station_nm").text(),a=t(this).find("dec_lat_va").text(),r=t(this).find("dec_long_va").text(),i=t(this).find("agency_cd").text(),n=t(this).find("county_cd").text(),s=t(this).find("huc_cd").text(),l=t(this).find("aqfr_cd").text(),c=t(this).find("well_depth_va").text(),p={type:"Feature",properties:{siteID:e,siteName:o,latDD:a,lonDD:r,agencyCode:i,countyCode:n,hucCode:s,aquiferCode:l,wellDepth:c},geometry:{type:"Point",coordinates:[parseFloat(r),parseFloat(a)]}};D.features.push(p)}),e.clear(),e.info("Drawing GeoJSON...",{timeOut:0}),i(D),console.log(D.features.length,"sites loaded"),e.clear(),t("#sitesPanel").collapse("toggle"),t("#filtersPanel").collapse("toggle")}})}function d(){e.info("Getting QW Data...",{timeOut:0});var o=b.toGeoJSON(),a={type:"FeatureCollection",features:[]};if(b.clearLayers(),o.features.length>0){console.log("querying NWIS...");var r=t("#CountySelect :selected").attr("stateCounty"),n=t("#parameterCodes").val(),s=n.split(","),l={site_tp_cd:"GW",param_cd_operator:"",group_key:"NONE",sitefile_output_format:"html_table",column_name:"agency_cd",column_name:"site_no",column_name:"station_nm",inventory_output:0,rdb_inventory_output:"file",begin_date:"",end_date:"",TZoutput:0,pm_cd_va_search:"",pm_cd_compare:"Greater%20than",pm_cd_result_va:"",radio_parm_cds:"previous_parm_cds",radio_previous_parm_cds:"",radio_multiple_parm_cds:"",radio_parm_cd_file:"",qw_attributes:0,format:"rdb",qw_sample_wide:"wide",rdb_qw_attributes:0,date_format:"YYYY-MM-DD",rdb_compression:"value"};if(I){var c="site_no\n";t.each(o.features[0].features,function(e,t){c+=t.properties.siteID+"\n"}),l.multiple_parameter_cds=n?n:"00940",l.list_of_search_criteria="site_no_file_attachment,multiple_parameter_cds,site_tp_cd",l.site_no_file_attachment={type:"text/plain",filename:"sites.txt",content:c};var p="-----------------------------"+Math.floor(Math.random()*Math.pow(10,8)),u=[];for(var d in l){u.push("--"+p);var f='Content-Disposition: form-data; name="'+d+'"; ';l[d].filename&&(f+='filename="'+l[d].filename+'";'),u.push(f),l[d].type&&u.push("Content-Type: "+l[d].type),u.push(""),u.push(l[d].content||l[d])}u.push("--"+p),t.ajax({type:"POST",url:"https://nwis.waterdata.usgs.gov/ny/nwis/qwdata",data:u.join("\r\n"),headers:{"Content-Type":"multipart/form-data; boundary="+p},cache:!1,processData:!1,contentType:!1,success:function(r){var n=g(r);console.log("got a response:",n.length,"sites"),t.each(o.features[0].features,function(e,o){var r=o,i=!1;t.each(n,function(e,a){o.properties.siteID===a.site_no&&(t.each(s,function(e,t){a.hasOwnProperty("p"+t)&&(r.properties["p"+t+"|"+a.sample_dt+" "+a.sample_tm+" "+a.sample_start_time_datum_cd+"|"+a.medium_cd]=a["p"+t])}),i=!0)}),i&&a.features.push(r)}),i(a),console.log(a.features.length,"sites loaded"),e.clear(),t("#filtersPanel").collapse("toggle"),t("#exportPanel").collapse("toggle")}})}else t.ajax({url:"https://nwis.waterdata.usgs.gov/ny/nwis/qwdata",data:{county_cd:r?r:"",site_tp_cd:"GW",group_key:"NONE",sitefile_output_format:"html_table",column_name:"agency_cd",column_name:"site_no",column_name:"station_nm",inventory_output:0,rdb_inventory_output:"file",TZoutput:0,pm_cd_compare:"Greater%20than",radio_parm_cds:"parm_cd_list",radio_multiple_parm_cds:n?n:"00940",qw_attributes:0,format:"rdb",qw_sample_wide:"wide",rdb_qw_attributes:0,date_format:"YYYY-MM-DD",rdb_compression:"YYYY-MM-DD",list_of_search_criteria:"site_tp_cd"},dataType:"text",success:function(r){var n=g(r);console.log("got a response:",n.length,"sites"),t.each(o.features[0].features,function(e,o){var r=o,i=!1;t.each(n,function(e,a){o.properties.siteID===a.site_no&&(t.each(s,function(e,t){a.hasOwnProperty("p"+t)&&(r.properties["p"+t+"|"+a.sample_dt+" "+a.sample_tm+" "+a.sample_start_time_datum_cd+"|"+a.medium_cd]=a["p"+t])}),i=!0)}),i&&a.features.push(r)}),i(a),console.log(a.features.length,"sites loaded"),e.clear(),t("#filtersPanel").collapse("toggle"),t("#exportPanel").collapse("toggle")}})}else e.error("Error","No sites to display")}function f(){if(b.toGeoJSON().features[0]){var t=JSON.stringify(b.toGeoJSON().features[0]),o="data.geojson";_(t,o)}else e.error("Error","No sites to export")}function m(){if(b.toGeoJSON().features[0]){var t=b.toGeoJSON().features[0],o=r(t),a="data.kml";_(o,a)}else e.error("Error","No sites to export")}function _(e,t){var o=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,t);else{var a=document.createElement("a"),r=URL.createObjectURL(o);void 0!==a.download?(a.setAttribute("href",r),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(r)}}function g(e){var o,a=e.split(/\r?\n/),r=[];return t.each(a,function(e,t){var a={};if("#"!=t[0]){var i=t.split("\t");if("agency_cd"===i[0]&&(o=i),"5s"!==i[0]&&"agency_cd"!==i[0]){for(var n=0;n<o.length;n++)a[o[n]]=i[n];r.push(a)}}}),r}function y(e){switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="Terrain";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}w&&v.removeLayer(w),w=o.basemapLayer(e),v.addLayer(w),N&&v.removeLayer(N),"Gray"!==e&&"Imagery"!==e&&"Terrain"!==e||(N=o.basemapLayer(e+"Labels"),v.addLayer(N))}function h(){I=!1,b.clearLayers(),v.setView([x,S],7)}var v,D,b,w,N,I,S="-76.2",x="42.7",F={radius:4,fillColor:"#ff7800",color:"#000",weight:1,opacity:1,fillOpacity:.8},C=[],k=[{layerID:"1",layerName:"NY WSC Sub-district",outFields:["subdist","FID"],dropDownID:"WSCsubDist"},{layerID:"2",layerName:"Senate District",outFields:["NAMELSAD","FID","Rep_Name"],dropDownID:"SenateDist"},{layerID:"3",layerName:"Assembly District",outFields:["NAMELSAD","FID","AD_Name"],dropDownID:"AssemDist"},{layerID:"4",layerName:"Congressional District",outFields:["NAMELSAD","FID","CD_Name"],dropDownID:"CongDist"},{layerID:"5",layerName:"County",outFields:["County_Nam","FID"],dropDownID:"County"},{layerID:"6",layerName:"Hydrologic Unit",outFields:["HUC_8","FID","HU_8_Name"],dropDownID:"HUC8"}],G=[{groupHeading:"Filters",showGroupHeading:!0,includeInLayerList:!0,layers:{"USGS Sub-district":{url:"https://www.sciencebase.gov/arcgis/rest/services/Catalog/56ba63bae4b08d617f6490d2/MapServer",layers:[1,2,3,4,5,6],visible:!1,opacity:.8,wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0}}}}];e.options={positionClass:"toast-bottom-right"},t(document).ready(function(){console.log("Application Information: production version 0.0.1"),t("#appVersion").html("Application Information: production version 0.0.1"),v=L.map("mapDiv",{zoomControl:!1}),L.control.zoom({position:"topright"}).addTo(v),L.control.scale().addTo(v),layer=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ",maxZoom:16}).addTo(v),v.setView([x,S],7),b=L.featureGroup().addTo(v),s(),u(),t("#mobile-main-menu").click(function(){t("body").toggleClass("isOpenMenu")}),t(".basemapBtn").click(function(){t(".basemapBtn").removeClass("slick-btn-selection"),t(this).addClass("slick-btn-selection");var e=this.id.replace("btn","");y(e)}),t("#loadSites").click(function(){u()}),t("#resetView").click(function(){h()}),t("#resetFilters").click(function(){n()}),t("#aboutButton").click(function(){t("#aboutModal").modal("show")}),t("#getQWdata").click(function(){d()}),t("#exportGeoJSON").click(function(){f()}),t("#exportKML").click(function(){m()}),t(".NWISselect").on("change",function(){var e=t("option:selected",this).parent().attr("id"),o=t("option:selected",this).text(),a=t("option:selected",this).attr("value"),r={selectName:e,optionName:o,optionValue:a};p(r)}),t("#geoFilterSelect").on("changed.bs.select",function(o,a,r,n){console.log("testing if this works",o.target,a,r,n);var s=t(o.target).attr("id"),l=t(o.target).find("option:selected"),p=l.length,u=t(o.target).find("option")[a];if(console.log("current selected: ",u,s),0==l.length){console.log("here",s,C);var d=C.indexOf(s);d>-1&&C.splice(d,1)}if(0==r)var f=t(this).find("option:selected").attr("layerID"),m=t(this).find("option:selected").attr("value"),_=t(o.target).find("option:selected").text();else var f=t(u).attr("layerID"),m=t(u).attr("value"),_=t(u).text();if(console.log("GeoFilter selected: ",_,m,f,s,p),t.each(t("#geoFilterSelect").find("option:selected"),function(e,o){var a=t(o).parent().attr("id");C.indexOf(a)==-1&&C.push(a)}),console.log("geoselect with selections in:",C),0==p&&0==C.length)e.info("You just unselected all options, resetting filters","Info");else if(f){var g="FID = "+m;p>1&&(g=t(l).map(function(){return"FID = "+this.value}).get().join(" or ")),console.log("running quere where:",g),e.info(s+" equals "+_,"Querying sites where... "),mapServer.query().layer(f).returnGeometry(!0).where(g).run(function(o,a){if(a.features.length>0){if(C.length>1)var r=b.toGeoJSON().features[0],n=c(r,a);else var n=c(D,a);n?(I=!0,i(n)):(console.log("here",u,t(u).prop("selected")),t(u).prop("selected",!1),t(".selectpicker").selectpicker("refresh"))}else e.error("Error","Geometry query did not return any features")})}}),t("#geoFilterSelect").on("change",".selectpicker",function(){})})}).call(t,o(1),o(2),o(4),o(6),o(10))}]);